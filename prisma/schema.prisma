generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  TRADER
  ADMIN
}

enum OrderStatus {
  REQUESTED
  APPROVED
  PROCESSING
  DISPATCHED
  DELIVERED
  CANCELLED
}

enum BillStatus {
  UNPAID
  PAID
}

model Bill {
  id             Int        @id @default(autoincrement())
  orderId        Int        @unique

  baseAmount     Float
  transportFee   Float      @default(0)
  extraCharges   Float      @default(0)
  discount       Float      @default(0)
  totalAmount    Float

  notes          String?
  status         BillStatus @default(UNPAID)

  order          Order      @relation(fields: [orderId], references: [id])

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}




model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  phone     String?
  password  String
  role      Role     @default(USER)

  city      String?

  // âœ… ADDRESS FIELDS
  addressLine1 String?
  addressLine2 String?
  state        String?
  pincode      String?

  mapLink       String?
  isActive  Boolean  @default(true)

  userOrders   Order[] @relation("UserOrders")
  traderOrders Order[] @relation("TraderOrders")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Product {
  id             Int      @id @default(autoincrement())
  name           String
  slug           String   @unique
  description    String?
  imageUrl       String?
  retailPrice    Float
  wholesalePrice Float
  isActive       Boolean  @default(true)
  inStock        Boolean  @default(true)
  orderItems     OrderItem[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Order {
  id          Int         @id @default(autoincrement())
  orderCode   String      @unique
  status      OrderStatus @default(REQUESTED)

  userId      Int?
  traderId    Int?

  user        User? @relation("UserOrders", fields: [userId], references: [id])
  trader      User? @relation("TraderOrders", fields: [traderId], references: [id])

  items       OrderItem[]
  totalAmount Float?
  bill        Bill?       // ðŸ‘ˆ THIS LINE IS REQUIRED

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Float

  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  message   String

  createdAt DateTime @default(now())
}
