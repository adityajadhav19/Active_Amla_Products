generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Bill {
  id           Int        @id @default(autoincrement())
  orderId      Int        @unique
  baseAmount   Float
  transportFee Float      @default(0)
  extraCharges Float      @default(0)
  discount     Float      @default(0)
  totalAmount  Float
  notes        String?
  status       BillStatus @default(UNPAID)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  order        Order      @relation(fields: [orderId], references: [id])
}

model User {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  phone        String?
  password     String
  role         Role     @default(USER)
  city         String?
  addressLine1 String?
  addressLine2 String?
  state        String?
  pincode      String?
  mapLink      String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  traderOrders Order[]  @relation("TraderOrders")
  userOrders   Order[]  @relation("UserOrders")
}

model Product {
  id             Int         @id @default(autoincrement())
  name           String
  slug           String      @unique
  description    String?
  imageUrl       String?
  retailPrice    Float
  wholesalePrice Float
  isActive       Boolean     @default(true)
  inStock        Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  orderItems     OrderItem[]
}

model Order {
  id          Int         @id @default(autoincrement())
  orderCode   String      @unique
  status      OrderStatus @default(REQUESTED)
  userId      Int?
  traderId    Int?
  totalAmount Float?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  bill        Bill?
  trader      User?       @relation("TraderOrders", fields: [traderId], references: [id])
  user        User?       @relation("UserOrders", fields: [userId], references: [id])
  items       OrderItem[]
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Float
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  message   String
  createdAt DateTime @default(now())
}

enum Role {
  USER
  TRADER
  ADMIN
}

enum OrderStatus {
  REQUESTED
  APPROVED
  PROCESSING
  DISPATCHED
  DELIVERED
  CANCELLED
}

enum BillStatus {
  UNPAID
  PAID
}
